## komodo_ccxt_bridge

![coverage][coverage_badge]
[![style: very good analysis][very_good_analysis_badge]][very_good_analysis_link]
[![License: MIT][license_badge]][license_link]

Generated by the [Very Good CLI][very_good_cli_link] ðŸ¤–

CCXT-compatible API bridge (Shelf) for KDF via SDK.

### Run

```sh
dart run komodo_ccxt_bridge serve --host 0.0.0.0 --port 8080 \
  --kdf-url http://127.0.0.1:7783 --kdf-pass <rpc-userpass>
```

Health check: `GET /health` â†’ `ok`.

#### Serve options

- `--host` (default `0.0.0.0`)
- `--port` (default `8080`)
- `--kdf-url` (default `http://127.0.0.1:7783`) Remote KDF RPC HTTP endpoint
- `--kdf-pass` RPC userpass for the KDF

### Endpoints

- `GET /health`

  - Returns `ok`.

- `GET /markets`

  - Returns enabled symbols from the node.
  - Response: `{ "symbols": ["KMD", "BTC", ...] }`

- `GET /orderbook?base=KMD&rel=BTC`

  - Returns a simplified orderbook snapshot.
  - Response:

    ```json
    {
      "symbol": "KMD/BTC",
      "bids": [["price","max_volume"], ...],
      "asks": [["price","max_volume"], ...],
      "timestamp": 1712345678
    }
    ```

- `GET /balance?coin=KMD`

  - Response:

    ```json
    { "coin": "KMD", "address": "...", "balance": "1.23", "unspendable": "0" }
    ```

- `POST /orders`

  - Body:

    ```json
    {
      "base": "KMD",
      "rel": "BTC",
      "price": "0.00001",
      "volume": "100",
      "minVolume": "10",
      "baseConfs": 1,
      "baseNota": false,
      "relConfs": 1,
      "relNota": false
    }
    ```

  - Response: the created order info from KDF.

- `DELETE /orders/<uuid>`

  - Response: `{ "cancelled": true }`

- `GET /orders/open`

  - Response: `{ "orders": [ ...MyOrderInfo... ] }`

- `GET /orders/<uuid>`

  - Looks up the order in `my_orders` and returns it if present.

- `GET /trades/my?limit=50&page=1&fromUuid=...&myCoin=KMD&otherCoin=BTC&fromTs=...&toTs=...`
  - Response: `{ "swaps": [ ...SwapInfo... ] }`

### Examples

- Run server:

```sh
dart run komodo_ccxt_bridge serve \
  --kdf-url http://127.0.0.1:7783 \
  --kdf-pass "$KDF_USERPASS"
```

- Health:

```sh
curl -s http://localhost:8080/health
```

- Markets (enabled coins):

```sh
curl -s http://localhost:8080/markets | jq
```

- Orderbook for `KMD/BTC`:

```sh
curl -s "http://localhost:8080/orderbook?base=KMD&rel=BTC" | jq
```

- Balance for `KMD`:

```sh
curl -s "http://localhost:8080/balance?coin=KMD" | jq
```

- Create maker order:

```sh
curl -sX POST http://localhost:8080/orders \
  -H 'content-type: application/json' \
  -d '{"base":"KMD","rel":"BTC","price":"0.00001","volume":"100"}' | jq
```

- Cancel order:

```sh
curl -sX DELETE http://localhost:8080/orders/<uuid> | jq
```

- My open orders:

```sh
curl -s http://localhost:8080/orders/open | jq
```

- My recent swaps:

```sh
curl -s 'http://localhost:8080/trades/my?limit=50' | jq
```

---

## Getting Started ðŸš€

If the CLI application is available on [pub](https://pub.dev), activate globally via:

```sh
dart pub global activate komodo_ccxt_bridge
```

Or locally via:

```sh
dart pub global activate --source=path <path to this package>
```

## Usage

```sh
# Show CLI version
$ komodo_ccxt_bridge --version

# Show usage help
$ komodo_ccxt_bridge --help
```

## Running Tests with coverage ðŸ§ª

To run all unit tests use the following command:

```sh
dart pub global activate coverage 1.2.0
dart test --coverage=coverage
dart pub global run coverage:format_coverage --lcov --in=coverage --out=coverage/lcov.info
```

To view the generated coverage report you can use [lcov](https://github.com/linux-test-project/lcov)
.

```sh
# Generate Coverage Report
$ genhtml coverage/lcov.info -o coverage/

# Open Coverage Report
$ open coverage/index.html
```

---

[coverage_badge]: coverage_badge.svg
[license_badge]: https://img.shields.io/badge/license-MIT-blue.svg
[license_link]: https://opensource.org/licenses/MIT
[very_good_analysis_badge]: https://img.shields.io/badge/style-very_good_analysis-B22C89.svg
[very_good_analysis_link]: https://pub.dev/packages/very_good_analysis
[very_good_cli_link]: https://github.com/VeryGoodOpenSource/very_good_cli
